{"version":3,"sources":["webpack:///C:/Users/Administrator/Desktop/wechat/pages/chat/chat.vue?a07a","webpack:///C:/Users/Administrator/Desktop/wechat/pages/chat/chat.vue?ed3c","webpack:///C:/Users/Administrator/Desktop/wechat/main.js","webpack:///C:/Users/Administrator/Desktop/wechat/pages/chat/chat.vue?8e7d","webpack:///C:/Users/Administrator/Desktop/wechat/pages/chat/chat.vue?63cf","webpack:///C:/Users/Administrator/Desktop/wechat/pages/chat/chat.vue?37ae","webpack:///C:/Users/Administrator/Desktop/wechat/pages/chat/chat.vue?7c35","webpack:///C:/Users/Administrator/Desktop/wechat/pages/chat/chat.vue"],"names":["createPage","Page","data","fromUserInfo","formData","content","limit","index","messageList","loading","imgHeight","mpInputMargin","chatType","voiceTitle","Recorder","uni","getRecorderManager","Audio","createInnerAudioContext","recording","isStopVoice","voiceInterval","voiceTime","canSend","PointY","voiceIconText","showFunBtn","AudioExam","funList","icon","title","uploadType","methods","joinData","getMessageData","sel","hasBeenSentId","length","$nextTick","bindScroll","setTimeout","duration","query","createSelectorQuery","in","select","boundingClientRect","pageScrollTo","scrollTop","top","exec","getData","arr","startIndex","endIndex","i","isItMe","Math","random","unshift","fromUserHeadImg","_user_info","headImg","fromUserId","id","createTime","Date","now","contentType","anmitionPlay","Promise","resolve","reject","switchChatType","type","switchFun","hideKeyboard","sendMsg","params","contentDuration","$u","trim","push","touchstart","linkToBusinessCard","userId","route","url","startVoice","e","paused","stopAudio","touches","clientY","start","format","beginVoice","stop","setInterval","moveVoice","slideY","upx2px","endVoice","cancelVoice","handleRecorder","tempFilePath","ceil","handleAudio","item","playAudio","src","play","closeAnmition","find","it","clickGrid","chooseImage","sourceType","sizeType","success","res","tempFilePaths","viewImg","imgList","previewImage","urls","onPageScroll","onNavigationBarButtonTap","onBackPress","onLoad","info","userInfo","firendList","filter","fromUserName","userName","messageId","onStart","onStop","clearInterval","onEnded","onReady","setNavigationBarTitle","getSystemInfo","windowHeight","onKeyboardHeightChange","height"],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAo4C,CAAgB,6wCAAG,EAAC,C;;;;;;;;;;;ACAx5C,uC;;;;;;;;;;;;kDCAA;;AAEA;AACA,yF;AACAA,UAAU,CAACC,aAAD,CAAV,C;;;;;;;;;;;;;ACJA;AAAA;AAAA;AAAA;AAAA;AAAA;AAA+F;AACvC;AACL;AACsC;;;AAGzF;AACiJ;AACjJ,gBAAgB,sJAAU;AAC1B,EAAE,0EAAM;AACR,EAAE,2FAAM;AACR,EAAE,oGAAe;AACjB;AACA;AACA;AACA;;AAEA;;AAEA;AACA,IAAI,KAAU,EAAE,YAiBf;AACD;AACe,gF;;;;;;;;;;;;ACvCf;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA,WAAW,mBAAO,CAAC,4BAAoB;;AAEvC,WAAW,mBAAO,CAAC,+BAAuB;;AAE1C,WAAW,mBAAO,CAAC,0BAAkB;;AAErC;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACtBA;AAAA;AAAA;AAAA;AAA8zB,CAAgB,yxBAAG,EAAC,C;;;;;;;;;;;;+9CCAl1B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA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","file":"pages/chat/chat.js","sourcesContent":["import mod from \"-!../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-1!../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/index.js??ref--8-oneOf-1-2!../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/sass-loader/lib/loader.js??ref--8-oneOf-1-4!../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/vue-loader/lib/index.js??vue-loader-options!../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-custom-block-loader/index.js??ref--0-1!../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chat.vue?vue&type=style&index=0&id=f94476b6&lang=scss&scoped=true&\"; export default mod; export * from \"-!../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-1!../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/index.js??ref--8-oneOf-1-2!../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/sass-loader/lib/loader.js??ref--8-oneOf-1-4!../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/vue-loader/lib/index.js??vue-loader-options!../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-custom-block-loader/index.js??ref--0-1!../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chat.vue?vue&type=style&index=0&id=f94476b6&lang=scss&scoped=true&\"","// extracted by mini-css-extract-plugin","import 'uni-pages';\n\nimport Vue from 'vue'            \nimport Page from './pages/chat/chat.vue'\ncreatePage(Page)","import { render, staticRenderFns } from \"./chat.vue?vue&type=template&id=f94476b6&scoped=true&\"\nimport script from \"./chat.vue?vue&type=script&lang=js&\"\nexport * from \"./chat.vue?vue&type=script&lang=js&\"\nimport style0 from \"./chat.vue?vue&type=style&index=0&id=f94476b6&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"f94476b6\",\n  null\n  \n)\n\n/* hot reload */\nif (module.hot) {\n  var api = require(\"C:\\\\Program Files\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\vue-hot-reload-api\\\\dist\\\\index.js\")\n  api.install(require('vue'))\n  if (api.compatible) {\n    module.hot.accept()\n    if (!module.hot.data) {\n      api.createRecord('f94476b6', component.options)\n    } else {\n      api.reload('f94476b6', component.options)\n    }\n    module.hot.accept(\"./chat.vue?vue&type=template&id=f94476b6&scoped=true&\", function () {\n      api.rerender('f94476b6', {\n        render: render,\n        staticRenderFns: staticRenderFns\n      })\n    })\n  }\n}\ncomponent.options.__file = \"Users/Administrator/Desktop/wechat/pages/chat/chat.vue\"\nexport default component.exports","export * from \"-!../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--16-0!../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/vue-loader/lib/index.js??vue-loader-options!../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-custom-block-loader/index.js??ref--0-1!../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chat.vue?vue&type=template&id=f94476b6&scoped=true&\"","var render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var m0 = require(\"@/static/voice.png\")\n\n  var m1 = require(\"@/static/keyboard.png\")\n\n  var m2 = require(\"@/static/add.png\")\n\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        m0: m0,\n        m1: m1,\n        m2: m2\n      }\n    }\n  )\n}\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns }","import mod from \"-!../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/vue-loader/lib/index.js??vue-loader-options!../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-custom-block-loader/index.js??ref--0-1!../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chat.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/vue-loader/lib/index.js??vue-loader-options!../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-custom-block-loader/index.js??ref--0-1!../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chat.vue?vue&type=script&lang=js&\"","//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n//\r\n\r\nexport default {\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\tfromUserInfo: {},\r\n\t\t\tformData: {\r\n\t\t\t\tcontent: '',\r\n\t\t\t\tlimit: 15,\r\n\t\t\t\tindex: 1\r\n\t\t\t},\r\n\t\t\tmessageList: [],\r\n\t\t\tloading: true, //标识是否正在获取数据\r\n\t\t\timgHeight: '1000px',\r\n\t\t\tmpInputMargin: false, //适配微信小程序 底部输入框高度被顶起的问题\r\n\t\t\tchatType:\"voice\",  // 图标类型 'voice'语音 'keyboard'键盘\r\n\t\t\tvoiceTitle: '按住 说话',\r\n\t\t\tRecorder: uni.getRecorderManager(),\r\n\t\t\tAudio: uni.createInnerAudioContext(),\r\n\t\t\trecording: false, //标识是否正在录音\r\n\t\t\tisStopVoice: false, //加锁 防止点击过快引起的当录音正在准备(还没有开始录音)的时候,却调用了stop方法但并不能阻止录音的问题\r\n\t\t\tvoiceInterval:null,\r\n\t\t\tvoiceTime:0, //总共录音时长\r\n\t\t\tcanSend:true, //是否可以发送\r\n\t\t\tPointY:0, //坐标位置\r\n\t\t\tvoiceIconText:\"正在录音...\",\r\n\t\t\tshowFunBtn:false, //是否展示功能型按钮\r\n\t\t\tAudioExam:null, //正在播放音频的实例\r\n\t\t\tfunList: [\r\n\t\t\t\t{ icon:\"photo-fill\",title:\"照片\",uploadType:[\"album\"] },\r\n\t\t\t\t{ icon:\"camera-fill\",title:\"拍摄\",uploadType:[\"camera\"] },\r\n\t\t\t],\r\n\t\t};\r\n\t},\r\n\tmethods: {\r\n\t\t//拼接消息 处理滚动\r\n\t\tasync joinData() {\r\n\t\t\tif (!this.loading) {\r\n\t\t\t\t//如果没有获取数据 即loading为false时，return 避免用户重复上拉触发加载\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.loading = false;\r\n\t\t\tconst data = await this.getMessageData();\r\n\t\t\t//获取节点信息\r\n\t\t\tconst { index } = this.formData;\r\n\t\t\tconst sel = `#msg-${index > 1 ? this.messageList[0].hasBeenSentId : data[data.length - 1].hasBeenSentId}`;\r\n\t\t\tthis.messageList = [...data, ...this.messageList];\r\n\t\t\t//填充数据后，视图会自动滚动到最上面一层然后瞬间再跳回bindScroll的指定位置 ---体验不是很好，后期优化\r\n\t\t\tthis.$nextTick(() => {\r\n\t\t\t\tthis.bindScroll(sel);\r\n\t\t\t\t//如果还有数据\r\n\t\t\t\tif (this.formData.limit >= data.length) {\r\n\t\t\t\t\tthis.formData.index++;\r\n\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\tthis.loading = true;\r\n\t\t\t\t\t}, 200);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\t//处理滚动\r\n\t\tbindScroll(sel, duration = 0) {\r\n\t\t\tconst query = uni.createSelectorQuery().in(this);\r\n\t\t\tquery\r\n\t\t\t\t.select(sel)\r\n\t\t\t\t.boundingClientRect(data => {\r\n\t\t\t\t\tuni.pageScrollTo({\r\n\t\t\t\t\t\tscrollTop: data && data.top - 40,\r\n\t\t\t\t\t\tduration\r\n\t\t\t\t\t});\r\n\t\t\t\t})\r\n\t\t\t\t.exec();\r\n\t\t},\r\n\t\t//获取消息\r\n\t\tgetMessageData() {\r\n\t\t\tlet getData = () => {\r\n\t\t\t\tlet arr = [];\r\n\t\t\t\tlet startIndex = (this.formData.index - 1) * this.formData.limit;\r\n\t\t\t\tlet endIndex = startIndex + this.formData.limit;\r\n\t\t\t\tfor (let i = startIndex; i < endIndex; i++) {\r\n\t\t\t\t\tconst isItMe = Math.random() > 0.5 ? true : false;\r\n\t\t\t\t\tarr.unshift({\r\n\t\t\t\t\t\thasBeenSentId: i, //已发送过去消息的id\r\n\t\t\t\t\t\tcontent: `很高兴认识你，这是第${i + 1}条消息。`,\r\n\t\t\t\t\t\tfromUserHeadImg: isItMe ? this._user_info.headImg : this.fromUserInfo.fromUserHeadImg, //用户头像\r\n\t\t\t\t\t\tfromUserId: isItMe ? this._user_info.id : this.fromUserInfo.fromUserId,\r\n\t\t\t\t\t\tisItMe, //true此条信息是我发送的 false别人发送的\r\n\t\t\t\t\t\tcreateTime: Date.now(),\r\n\t\t\t\t\t\tcontentType: 1, // 1文字文本 2语音\r\n\t\t\t\t\t\tanmitionPlay: false //标识音频是否在播放\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\treturn arr;\r\n\t\t\t};\r\n\t\t\treturn new Promise((resolve, reject) => {\r\n\t\t\t\tconst data = getData();\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tresolve(data);\r\n\t\t\t\t}, 500);\r\n\t\t\t});\r\n\t\t},\r\n\t\t//切换语音或者键盘方式\r\n\t\tswitchChatType(type) {\r\n\t\t\tthis.chatType = type;\r\n\t\t\tthis.showFunBtn =false;\r\n\t\t},\r\n\t\t//切换功能性按钮\r\n\t\tswitchFun(){\r\n\t\t\tthis.chatType = 'keyboard'\r\n\t\t\tthis.showFunBtn = !this.showFunBtn;\r\n\t\t\tuni.hideKeyboard()\r\n\t\t},\r\n\t\t//发送消息\r\n\t\tsendMsg(data) {\r\n\t\t\tconst params = {\r\n\t\t\t\thasBeenSentId: Date.now(), //已发送过去消息的id\r\n\t\t\t\tcontent: this.formData.content,\r\n\t\t\t\tfromUserHeadImg: this._user_info.headImg, //用户头像\r\n\t\t\t\tfromUserId: this._user_info.id,\r\n\t\t\t\tisItMe: true, //true此条信息是我发送的  false别人发送的\r\n\t\t\t\tcreateTime: Date.now(),\r\n\t\t\t\tcontentType: 1\r\n\t\t\t};\r\n\r\n\t\t\tif (data) {\r\n\t\t\t\tif(data.contentType == 2){\r\n\t\t\t\t\t//说明是发送语音\r\n\t\t\t\t\tparams.content = data.content;\r\n\t\t\t\t\tparams.contentType = data.contentType;\r\n\t\t\t\t\tparams.contentDuration = data.contentDuration;\r\n\t\t\t\t\tparams.anmitionPlay = false;\r\n\t\t\t\t}else if(data.contentType == 3){\r\n\t\t\t\t\t//发送图片\r\n\t\t\t\t\tparams.content = data.content;\r\n\t\t\t\t\tparams.contentType = data.contentType;\r\n\t\t\t\t}\r\n\t\t\t} else if (!this.$u.trim(this.formData.content)) {\r\n\t\t\t\t//验证输入框书否为空字符传\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tthis.messageList.push(params);\r\n\r\n\t\t\tthis.$nextTick(() => {\r\n\t\t\t\tthis.formData.content = '';\r\n\r\n\t\t\t\t\tif(params.contentType == 1){\r\n\t\t\t\t\t\tuni.pageScrollTo({\r\n\t\t\t\t\t\t\tscrollTop: 99999,\r\n\t\t\t\t\t\t\tduration: 0, //小程序如果有滚动效果 input的焦点也会随着页面滚动...\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tsetTimeout(()=>{\r\n\t\t\t\t\t\t\tuni.pageScrollTo({\r\n\t\t\t\t\t\t\t\tscrollTop: 99999,\r\n\t\t\t\t\t\t\t\tduration: 0, //小程序如果有滚动效果 input的焦点也会随着页面滚动...\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t},150)\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\r\n\r\n\r\n\r\n\r\n\r\n\r\n\t\t\t\t\r\n\t\t\t\tif(this.showFunBtn){\r\n\t\t\t\t\tthis.showFunBtn = false;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\r\n\t\t\t\tif (params.contentType == 1) {\r\n\t\t\t\t\tthis.mpInputMargin = true;\r\n\t\t\t\t} \r\n\r\n\t\t\t\t//h5浏览器并没有很好的办法控制键盘一直处于唤起状态 而且会有样式性的问题\r\n\r\n\r\n\r\n\t\t\t});\r\n\t\t},\r\n\t\t//用户触摸屏幕的时候隐藏键盘\r\n\t\ttouchstart() {\r\n\t\t\tuni.hideKeyboard();\r\n\t\t},\r\n\t\t// userid 用户id\r\n\t\tlinkToBusinessCard(userId) {\r\n\t\t\tthis.$u.route({\r\n\t\t\t\turl: 'pages/businessCard/businessCard',\r\n\t\t\t\tparams: {\r\n\t\t\t\t\tuserId\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\t//准备开始录音\r\n\t\tstartVoice(e) {\r\n\t\t\tif(!this.Audio.paused){\r\n\t\t\t\t//如果音频正在播放 先暂停。\r\n\t\t\t\tthis.stopAudio(this.AudioExam)\r\n\t\t\t}\r\n\t\t\tthis.recording = true;\r\n\t\t\tthis.isStopVoice = false;\r\n\t\t\tthis.canSend = true;\r\n\t\t\tthis.voiceIconText = \"正在录音...\"\r\n\t\t\tthis.PointY = e.touches[0].clientY;\r\n\t\t\tthis.Recorder.start({\r\n\t\t\t\tformat: 'mp3'\r\n\t\t\t});\r\n\t\t},\r\n\t\t//录音已经开始\r\n\t\tbeginVoice(){\r\n\t\t\tif (this.isStopVoice) {\r\n\t\t\t\tthis.Recorder.stop();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.voiceTitle = '松开 结束'\r\n\t\t\tthis.voiceInterval =  setInterval(()=>{\r\n\t\t\t\tthis.voiceTime ++;\r\n\t\t\t},1000)\r\n\t\t},\r\n\t\t//move 正在录音中\r\n\t\tmoveVoice(e){\r\n\t\t\tconst PointY = e.touches[0].clientY\r\n\t\t\tconst slideY = this.PointY - PointY;\r\n\t\t\tif(slideY > uni.upx2px(120)){\r\n\t\t\t\tthis.canSend = false;\r\n\t\t\t\tthis.voiceIconText = '松开手指 取消发送 '\r\n\t\t\t}else if(slideY > uni.upx2px(60)){\r\n\t\t\t\tthis.canSend = true;\r\n\t\t\t\tthis.voiceIconText = '手指上滑 取消发送 '\r\n\t\t\t}else{\r\n\t\t\t\tthis.voiceIconText = '正在录音... '\r\n\t\t\t}\r\n\t\t},\r\n\t\t//结束录音\r\n\t\tendVoice() {\r\n\t\t\tthis.isStopVoice = true; //加锁 确保已经结束录音并不会录制\r\n\t\t\tthis.Recorder.stop();\r\n\t\t\tthis.voiceTitle = '按住 说话'\r\n\t\t},\r\n\t\t//录音被打断\r\n\t\tcancelVoice(e){\r\n\t\t\tthis.voiceTime = 0;\r\n\t\t\tthis.voiceTitle = '按住 说话';\r\n\t\t\tthis.canSend = false;\r\n\t\t\tthis.Recorder.stop();\r\n\t\t},\r\n\t\t//处理录音文件\r\n\t\thandleRecorder({ tempFilePath,duration }) {\r\n\t\t\tlet contentDuration;\r\n\r\n\t\t\tthis.voiceTime = 0;\r\n\t\t\tif (duration < 600) {\r\n\t\t\t\tthis.voiceIconText=\"说话时间过短\";\r\n\t\t\t\tsetTimeout(()=>{\r\n\t\t\t\t\tthis.recording = false;\r\n\t\t\t\t},200)\r\n\t\t\t\treturn;\r\n\t\t\t} \r\n\t\t\tcontentDuration = duration/1000;\r\n\r\n\t\t\t\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\t\t\t\r\n\t\t\tthis.recording = false;\r\n\t\t\tconst params = {\r\n\t\t\t\tcontentType: 2,\r\n\t\t\t\tcontent: tempFilePath,\r\n\t\t\t\tcontentDuration: Math.ceil(contentDuration)\r\n\t\t\t};\r\n\t\t\tthis.canSend && this.sendMsg(params);\r\n\t\t},\r\n\t\t//控制播放还是暂停音频文件\r\n\t\thandleAudio(item) {\r\n\t\t\tthis.AudioExam = item;\r\n\t\t\tthis.Audio.paused ? this.playAudio(item) : this.stopAudio(item);\r\n\t\t},\r\n\t\t//播放音频\r\n\t\tplayAudio(item) {\r\n\t\t\tthis.Audio.src = item.content;\r\n\t\t\tthis.Audio.hasBeenSentId = item.hasBeenSentId;\r\n\t\t\tthis.Audio.play();\r\n\t\t\titem.anmitionPlay = true;\r\n\t\t},\r\n\t\t//停止音频\r\n\t\tstopAudio(item) {\r\n\t\t\titem.anmitionPlay = false;\r\n\t\t\tthis.Audio.src = '';\r\n\t\t\tthis.Audio.stop();\r\n\t\t},\r\n\t\t//关闭动画\r\n\t\tcloseAnmition() {\r\n\t\t\tconst hasBeenSentId = this.Audio.hasBeenSentId;\r\n\t\t\tconst item = this.messageList.find(it => it.hasBeenSentId == hasBeenSentId);\r\n\t\t\titem.anmitionPlay = false;\r\n\t\t},\r\n\t\t//点击宫格时触发\r\n\t\tclickGrid(index){\r\n\t\t\tif(index == 0){\r\n\t\t\t\tthis.chooseImage(['album'])\r\n\t\t\t}else if(index == 1){\r\n\t\t\t\tthis.chooseImage(['camera'])\r\n\t\t\t}\r\n\t\t},\r\n\t\t//发送图片\r\n\t\tchooseImage(sourceType){\r\n\t\t\tuni.chooseImage({\r\n\t\t\t\tsourceType,\r\n\t\t\t\tsizeType:['compressed'], \r\n\t\t\t\tsuccess:res=>{ \r\n\t\t\t\t\tthis.showFunBtn = false;\r\n\t\t\t\t\tfor(let i = 0;i<res.tempFilePaths.length;i++){\r\n\t\t\t\t\t\tconst params = {\r\n\t\t\t\t\t\t\tcontentType: 3,\r\n\t\t\t\t\t\t\tcontent: res.tempFilePaths[i],\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tthis.sendMsg(params)\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t},\r\n\t\t//查看大图\r\n\t\tviewImg(imgList){\r\n\t\t\tuni.previewImage({\r\n\t\t\t\turls: imgList,\r\n\r\n\r\n\r\n\t\t\t});\r\n\t\t},\r\n\t},\r\n\tonPageScroll(e) {\r\n\t\tif (e.scrollTop < 50) {\r\n\t\t\tthis.joinData();\r\n\t\t}\r\n\t},\r\n\tonNavigationBarButtonTap({ index }) {\r\n\t\tif (index == 0) {\r\n\t\t\t//用户详情 设置\r\n\t\t} else if (index == 1) {\r\n\t\t\t//返回按钮\r\n\t\t\tthis.$u.route({\r\n\t\t\t\ttype: 'switchTab',\r\n\t\t\t\turl: 'pages/home/home'\r\n\t\t\t});\r\n\t\t}\r\n\t},\r\n\t//返回按钮事件\r\n\tonBackPress(e) {\r\n\t\t//以下内容对h5不生效\r\n\t\t//--所以如果用浏览器自带的返回按钮进行返回的时候页面不会重定向 正在寻找合适的解决方案\r\n\t\tthis.$u.route({\r\n\t\t\ttype: 'switchTab',\r\n\t\t\turl: 'pages/home/home'\r\n\t\t});\r\n\t\treturn true;\r\n\t},\r\n\tonLoad(info) {\r\n\t\t// { messageId,fromUserName,fromUserHeadImg } = info\r\n\t\tconst userInfo = this.firendList.filter(item => item.userId == info.fromUserId)[0];\r\n\t\tthis.fromUserInfo = {\r\n\t\t\tfromUserName: userInfo.userName,\r\n\t\t\tfromUserHeadImg: userInfo.headImg,\r\n\t\t\tfromUserId: userInfo.userId,\r\n\t\t\tmessageId: info.messageId\r\n\t\t};\r\n\r\n\t\t//录音开始事件\r\n\t\tthis.Recorder.onStart(e => {\r\n\t\t\t\r\n\t\t\tthis.beginVoice();\r\n\t\t});\r\n\t\t//录音结束事件\r\n\t\tthis.Recorder.onStop(res => {\r\n\t\t\tclearInterval(this.voiceInterval);\r\n\t\t\tthis.handleRecorder(res);\r\n\t\t});\r\n\r\n\t\t//音频停止事件\r\n\t\tthis.Audio.onStop(e => {\r\n\t\t\tthis.closeAnmition();\r\n\t\t});\r\n\r\n\t\t//音频播放结束事件\r\n\t\tthis.Audio.onEnded(e => {\r\n\t\t\tthis.closeAnmition();\r\n\t\t});\r\n\t},\r\n\tonReady() {\r\n\t\t//自定义返回按钮 因为原生的返回按钮不可阻止默认事件\r\n\r\n\r\n\r\n\r\n\r\n\t\tuni.setNavigationBarTitle({\r\n\t\t\ttitle: this.fromUserInfo.fromUserName\r\n\t\t});\r\n\t\tthis.joinData();\r\n\t\tuni.getSystemInfo({\r\n\t\t\tsuccess: res => {\r\n\t\t\t\tthis.imgHeight = res.windowHeight + 'px';\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\tuni.onKeyboardHeightChange(res => {\r\n\t\t\tif (res.height == 0) {\r\n\r\n\t\t\t\tthis.mpInputMargin = false;\r\n\r\n\t\t\t}else{\r\n\t\t\t\tthis.showFunBtn = false;\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n};\r\n"],"sourceRoot":""}